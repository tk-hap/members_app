#!/usr/bin/env bash

set -e

if [ "$1" == "web" ]; then
  shift
  echo "Applying migrations"
  python manage.py migrate

  echo "Running production server"
  exec gunicorn --bind 0.0.0.0:8000 members_app.wsgi $@
elif [ "$1" == "scheduler" ]; then
  shift
  exec celery -A members_app beat -l info $@
elif [ "$1" == "worker" ]; then
  shift
  exec celery -A members_app worker -l info $@
elif [ "$1" == "manage" ]; then
  shift
  exec python manage.py $@
else
    exec "$@"
fi